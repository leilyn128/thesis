{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/components/ui/card.jsx"],"sourcesContent":["export function Card({ children }) {\r\n  return <div className=\"bg-white rounded-xl shadow\">{children}</div>\r\n}\r\n\r\nexport function CardContent({ children, className }) {\r\n  return <div className={className}>{children}</div>\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,KAAK,EAAE,QAAQ,EAAE;IAC/B,qBAAO,wPAAC;QAAI,WAAU;kBAA8B;;;;;;AACtD;AAEO,SAAS,YAAY,EAAE,QAAQ,EAAE,SAAS,EAAE;IACjD,qBAAO,wPAAC;QAAI,WAAW;kBAAY;;;;;;AACrC","debugId":null}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/settings/page.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { supabase } from \"../../../lib/supabaseClient\"\r\nimport * as XLSX from \"xlsx\"\r\nimport { Card, CardContent } from \"@/components/ui/card\"\r\n\r\nexport default function SettingsPage() {\r\n  const [oldPassword, setOldPassword] = useState(\"\")\r\n  const [newPassword, setNewPassword] = useState(\"\")\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\")\r\n  const [message, setMessage] = useState(\"\")\r\n  const [loading, setLoading] = useState(false)\r\n  const [previewData, setPreviewData] = useState([])\r\n\r\n  // ‚úÖ Change password\r\n  const handleChangePassword = async (e) => {\r\n    e.preventDefault()\r\n    setMessage(\"\")\r\n    if (newPassword !== confirmPassword) {\r\n      setMessage(\"‚ùå New passwords do not match.\")\r\n      return\r\n    }\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n    if (userError || !user) {\r\n      setMessage(\"‚ö†Ô∏è User not found. Please log in again.\")\r\n      return\r\n    }\r\n\r\n    const { error: signInError } = await supabase.auth.signInWithPassword({\r\n      email: user.email,\r\n      password: oldPassword,\r\n    })\r\n    if (signInError) {\r\n      setMessage(\"‚ùå Old password is incorrect.\")\r\n      return\r\n    }\r\n\r\n    const { error } = await supabase.auth.updateUser({ password: newPassword })\r\n    if (error) setMessage(\"‚ùå \" + error.message)\r\n    else setMessage(\"‚úÖ Password updated successfully!\")\r\n\r\n    setOldPassword(\"\")\r\n    setNewPassword(\"\")\r\n    setConfirmPassword(\"\")\r\n  }\r\n\r\n  // ‚úÖ Export data as CSV\r\n  const handleExportCSV = async () => {\r\n    setLoading(true)\r\n    setMessage(\"\")\r\n    const { data, error } = await supabase.from(\"transactions\").select(\"*\")\r\n    setLoading(false)\r\n\r\n    if (error) {\r\n      setMessage(\"‚ùå Failed to export data: \" + error.message)\r\n      return\r\n    }\r\n\r\n    if (!data || data.length === 0) {\r\n      setMessage(\"‚ö†Ô∏è No data available to export.\")\r\n      return\r\n    }\r\n\r\n    const worksheet = XLSX.utils.json_to_sheet(data)\r\n    const workbook = XLSX.utils.book_new()\r\n    XLSX.utils.book_append_sheet(workbook, worksheet, \"Transactions\")\r\n    XLSX.writeFile(workbook, \"transactions_export.csv\")\r\n\r\n    setMessage(\"‚úÖ Data exported successfully!\")\r\n  }\r\n\r\n  // ‚úÖ Import Excel\r\n  const handleImportExcel = async (e) => {\r\n    const file = e.target.files[0]\r\n    if (!file) return\r\n\r\n    const fileExt = file.name.split(\".\").pop()\r\n    const timestamp = Date.now()\r\n    const storageFileName = `import_${timestamp}_${file.name}`\r\n\r\n    setLoading(true)\r\n    setMessage(\"Uploading file...\")\r\n\r\n    const { error: uploadError } = await supabase.storage\r\n      .from(\"imports\")\r\n      .upload(storageFileName, file, { upsert: false })\r\n\r\n    if (uploadError) {\r\n      setMessage(\"‚ùå Upload failed: \" + uploadError.message)\r\n      setLoading(false)\r\n      return\r\n    }\r\n\r\n    const { data: publicData } = supabase.storage.from(\"imports\").getPublicUrl(storageFileName)\r\n    const fileUrl = publicData.publicUrl\r\n\r\n    try {\r\n      const response = await fetch(fileUrl)\r\n      const arrayBuffer = await response.arrayBuffer()\r\n      const workbook = XLSX.read(arrayBuffer, { type: \"array\" })\r\n      const sheet = workbook.Sheets[workbook.SheetNames[0]]\r\n      const jsonData = XLSX.utils.sheet_to_json(sheet)\r\n\r\n      const normalizedData = jsonData.map((row) => ({\r\n        account_name: row[\"Account Name\"] || row[\"account_name\"] || \"\",\r\n        debit: row[\"Debit\"] || row[\"debit\"] || 0,\r\n        credit: row[\"Credit\"] || row[\"credit\"] || 0,\r\n      }))\r\n\r\n      setPreviewData(normalizedData)\r\n      setMessage(\"‚úÖ File uploaded successfully!\")\r\n\r\n      const detectedYear = file.name.match(/20\\d{2}/)?.[0] || new Date().getFullYear()\r\n\r\n      const formattedData = normalizedData.map((row) => ({\r\n        ...row,\r\n        year: detectedYear,\r\n      }))\r\n\r\n      const { error: insertError } = await supabase.from(\"trial_balance\").insert(formattedData)\r\n      if (insertError) {\r\n        console.error(insertError)\r\n        setMessage(\"‚ùå Failed to insert into trial_balance: \" + insertError.message)\r\n      } else {\r\n        setMessage(`‚úÖ Imported ${formattedData.length} rows into trial_balance (${detectedYear})`)\r\n      }\r\n    } catch (err) {\r\n      console.error(err)\r\n      setMessage(\"‚ùå Failed to read Excel file.\")\r\n    }\r\n\r\n    setLoading(false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 bg-white flex flex-col items-center pt-10 overflow-hidden\">\r\n      <div className=\"w-full max-w-6xl px-10\">\r\n        <h1 className=\"text-3xl font-bold text-green-700 mb-2\">‚öôÔ∏è Settings</h1>\r\n        <p className=\"text-sm text-gray-500 mb-8\">\r\n          Manage account and data preferences\r\n        </p>\r\n\r\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n          {/* üë§ Account Settings */}\r\n          <Card className=\"bg-white border border-gray-200\">\r\n            <CardContent className=\"p-6\">\r\n              <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">üë§ Account Settings</h2>\r\n\r\n              <form onSubmit={handleChangePassword} className=\"space-y-4\">\r\n                <div>\r\n                  <label className=\"block text-sm mb-2 font-medium\">Old Password</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={oldPassword}\r\n                    onChange={(e) => setOldPassword(e.target.value)}\r\n                    required\r\n                    className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm mb-2 font-medium\">New Password</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={newPassword}\r\n                    onChange={(e) => setNewPassword(e.target.value)}\r\n                    required\r\n                    className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className=\"block text-sm mb-2 font-medium\">Confirm New Password</label>\r\n                  <input\r\n                    type=\"password\"\r\n                    value={confirmPassword}\r\n                    onChange={(e) => setConfirmPassword(e.target.value)}\r\n                    required\r\n                    className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n                  />\r\n                </div>\r\n\r\n                <button\r\n                  type=\"submit\"\r\n                  disabled={loading}\r\n                  className=\"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition disabled:opacity-50\"\r\n                >\r\n                  {loading ? \"Processing...\" : \"Change Password\"}\r\n                </button>\r\n              </form>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* üìÇ Data Management */}\r\n          <Card className=\"bg-white border border-gray-200\">\r\n            <CardContent className=\"p-6\">\r\n              <h2 className=\"text-xl font-semibold mb-4 text-gray-800\">üìÇ Data Management</h2>\r\n\r\n              <div className=\"space-y-4\">\r\n                <button\r\n                  onClick={handleExportCSV}\r\n                  disabled={loading}\r\n                  className=\"w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition disabled:opacity-50\"\r\n                >\r\n                  {loading ? \"Exporting...\" : \"üì§ Export Data (CSV)\"}\r\n                </button>\r\n\r\n                <label className=\"w-full block\">\r\n                  <div className=\"bg-yellow-500 text-white py-2 text-center rounded-lg hover:bg-yellow-600 transition cursor-pointer\">\r\n                    üì• Import Data (Excel)\r\n                  </div>\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\".xlsx,.csv\"\r\n                    onChange={handleImportExcel}\r\n                    className=\"hidden\"\r\n                  />\r\n                </label>\r\n              </div>\r\n\r\n              <p className=\"text-xs text-gray-500 mt-3\">\r\n                Files are uploaded to your Supabase \"imports\" storage bucket.\r\n              </p>\r\n            </CardContent>\r\n          </Card>\r\n        </div>\r\n\r\n        {message && (\r\n          <p\r\n            className={`mt-6 text-sm ${\r\n              message.startsWith(\"‚úÖ\")\r\n                ? \"text-green-600\"\r\n                : message.startsWith(\"‚ö†Ô∏è\")\r\n                ? \"text-yellow-600\"\r\n                : \"text-red-600\"\r\n            }`}\r\n          >\r\n            {message}\r\n          </p>\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}