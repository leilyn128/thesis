{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ALDEGS09/thesis/app/%28protected%29/settings/page.jsx"],"sourcesContent":["\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { supabase } from \"../../../lib/supabaseClient\"\r\nimport * as XLSX from \"xlsx\"\r\n\r\nexport default function SettingsPage() {\r\n  const [oldPassword, setOldPassword] = useState(\"\")\r\n  const [newPassword, setNewPassword] = useState(\"\")\r\n  const [confirmPassword, setConfirmPassword] = useState(\"\")\r\n  const [message, setMessage] = useState(\"\")\r\n  const [loading, setLoading] = useState(false)\r\n  const [previewData, setPreviewData] = useState([]) // üëà for displaying uploaded file contents\r\n\r\n  // ‚úÖ Change password\r\n  const handleChangePassword = async (e) => {\r\n    e.preventDefault()\r\n    setMessage(\"\")\r\n    if (newPassword !== confirmPassword) {\r\n      setMessage(\"‚ùå New passwords do not match.\")\r\n      return\r\n    }\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser()\r\n    if (userError || !user) {\r\n      setMessage(\"‚ö†Ô∏è User not found. Please log in again.\")\r\n      return\r\n    }\r\n\r\n    const { error: signInError } = await supabase.auth.signInWithPassword({\r\n      email: user.email,\r\n      password: oldPassword,\r\n    })\r\n    if (signInError) {\r\n      setMessage(\"‚ùå Old password is incorrect.\")\r\n      return\r\n    }\r\n\r\n    const { error } = await supabase.auth.updateUser({ password: newPassword })\r\n    if (error) setMessage(\"‚ùå \" + error.message)\r\n    else setMessage(\"‚úÖ Password updated successfully!\")\r\n\r\n    setOldPassword(\"\")\r\n    setNewPassword(\"\")\r\n    setConfirmPassword(\"\")\r\n  }\r\n\r\n  // ‚úÖ Export data as CSV\r\n// ‚úÖ Export data as Excel (.xlsx)\r\nconst handleExportExcel = async () => {\r\n  setLoading(true)\r\n  setMessage(\"\")\r\n  const { data, error } = await supabase.from(\"transactions\").select(\"*\")\r\n  setLoading(false)\r\n\r\n  if (error) {\r\n    setMessage(\"‚ùå Failed to export data: \" + error.message)\r\n    return\r\n  }\r\n\r\n  if (!data || data.length === 0) {\r\n    setMessage(\"‚ö†Ô∏è No data available to export.\")\r\n    return\r\n  }\r\n\r\n  // ‚úÖ Format amount to show ‚Ç± and two decimal places\r\n  const formattedData = data.map((t) => ({\r\n    Date: t.date,\r\n    Type: t.type,\r\n    Category: t.category,\r\n    Amount: `‚Ç± ${Number(t.amount).toLocaleString(\"en-PH\", {\r\n      minimumFractionDigits: 2,\r\n      maximumFractionDigits: 2,\r\n    })}`,\r\n    Remarks: t.remarks || \"\",\r\n  }))\r\n\r\n  // ‚úÖ Create Excel sheet\r\n  const worksheet = XLSX.utils.json_to_sheet(formattedData)\r\n  const workbook = XLSX.utils.book_new()\r\n  XLSX.utils.book_append_sheet(workbook, worksheet, \"Transactions\")\r\n\r\n  // ‚úÖ Generate filename like \"transactions_2025-10-22.xlsx\"\r\n  const today = new Date().toISOString().split(\"T\")[0]\r\n  const filename = `transactions_${today}.xlsx`\r\n\r\n  // ‚úÖ Save Excel file\r\n  XLSX.writeFile(workbook, filename)\r\n\r\n  setMessage(\"‚úÖ Transactions exported to Excel successfully!\")\r\n}\r\n\r\nconst handleImportExcel = async (e) => {\r\n  const file = e.target.files[0]\r\n  if (!file) return\r\n\r\n  const fileExt = file.name.split(\".\").pop()\r\n  const timestamp = Date.now()\r\n  const storageFileName = `import_${timestamp}_${file.name}` // unique storage name\r\n\r\n  setLoading(true)\r\n  setMessage(\"Uploading file...\")\r\n\r\n  // Step 1Ô∏è‚É£ Upload to Supabase Storage\r\n  const { error: uploadError } = await supabase.storage\r\n    .from(\"imports\")\r\n    .upload(storageFileName, file, { upsert: false }) // do NOT overwrite\r\n\r\n  if (uploadError) {\r\n    setMessage(\"‚ùå Upload failed: \" + uploadError.message)\r\n    setLoading(false)\r\n    return\r\n  }\r\n\r\n  // Step 2Ô∏è‚É£ Get public URL\r\n  const { data: publicData } = supabase.storage.from(\"imports\").getPublicUrl(storageFileName)\r\n  const fileUrl = publicData.publicUrl\r\n\r\n  // Step 3Ô∏è‚É£ Parse Excel file\r\n  try {\r\n    const response = await fetch(fileUrl)\r\n    const arrayBuffer = await response.arrayBuffer()\r\n    const workbook = XLSX.read(arrayBuffer, { type: \"array\" })\r\n    const sheet = workbook.Sheets[workbook.SheetNames[0]]\r\n    const jsonData = XLSX.utils.sheet_to_json(sheet)\r\n\r\n    // Step 4Ô∏è‚É£ Normalize data\r\n    const normalizedData = jsonData.map((row) => ({\r\n      account_name: row[\"Account Name\"] || row[\"account_name\"] || \"\",\r\n      debit: row[\"Debit\"] || row[\"debit\"] || 0,\r\n      credit: row[\"Credit\"] || row[\"credit\"] || 0,\r\n    }))\r\n\r\n    setPreviewData(normalizedData)\r\n    setMessage(\"‚úÖ File uploaded successfully!\")\r\n\r\n    // Step 5Ô∏è‚É£ Determine Year\r\n    const detectedYear = file.name.match(/20\\d{2}/)?.[0] || new Date().getFullYear()\r\n\r\n    // Step 6Ô∏è‚É£ Insert into trial_balance\r\n    const formattedData = normalizedData.map((row) => ({\r\n      ...row,\r\n      year: detectedYear,\r\n    }))\r\n\r\n    const { error: insertError } = await supabase\r\n      .from(\"trial_balance\")\r\n      .insert(formattedData)\r\n\r\n    if (insertError) {\r\n      console.error(insertError)\r\n      setMessage(\"‚ùå Failed to insert into trial_balance: \" + insertError.message)\r\n    } else {\r\n      setMessage(`‚úÖ Imported ${formattedData.length} rows into trial_balance (${detectedYear})`)\r\n    }\r\n  } catch (err) {\r\n    console.error(err)\r\n    setMessage(\"‚ùå Failed to read Excel file.\")\r\n  }\r\n\r\n  setLoading(false)\r\n}\r\n\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-6 \">\r\n      <h1 className=\"text-3xl font-bold mb-8 text-green-700\">‚öôÔ∏è Settings</h1>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n        {/* üë§ Account Settings */}\r\n        <div className=\"bg-white p-6 rounded-2xl shadow\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">üë§ Account Settings</h2>\r\n\r\n          <form onSubmit={handleChangePassword} className=\"space-y-4\">\r\n            <div>\r\n              <label className=\"block text-sm mb-2 font-medium\">Old Password</label>\r\n              <input\r\n                type=\"password\"\r\n                value={oldPassword}\r\n                onChange={(e) => setOldPassword(e.target.value)}\r\n                required\r\n                className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm mb-2 font-medium\">New Password</label>\r\n              <input\r\n                type=\"password\"\r\n                value={newPassword}\r\n                onChange={(e) => setNewPassword(e.target.value)}\r\n                required\r\n                className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n              />\r\n            </div>\r\n\r\n            <div>\r\n              <label className=\"block text-sm mb-2 font-medium\">Confirm New Password</label>\r\n              <input\r\n                type=\"password\"\r\n                value={confirmPassword}\r\n                onChange={(e) => setConfirmPassword(e.target.value)}\r\n                required\r\n                className=\"w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-400\"\r\n              />\r\n            </div>\r\n\r\n            <button\r\n              type=\"submit\"\r\n              disabled={loading}\r\n              className=\"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition disabled:opacity-50\"\r\n            >\r\n              {loading ? \"Processing...\" : \"Change Password\"}\r\n            </button>\r\n          </form>\r\n        </div>\r\n\r\n      {/* üìÇ Data Management */}\r\n        <div className=\"bg-white p-6 rounded-2xl shadow\">\r\n          <h2 className=\"text-xl font-semibold mb-4\">üìÇ Data Management</h2>\r\n\r\n          <div className=\"space-y-4\">\r\n            <button\r\n               onClick={handleExportExcel}\r\n               disabled={loading}\r\n                className=\"w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition disabled:opacity-50\"\r\n              >\r\n                {loading ? \"Exporting...\" : \"üì§ Export Transactions (Excel)\"}\r\n              </button>\r\n\r\n\r\n            <label className=\"w-full block\">\r\n              <div className=\"bg-yellow-500 text-white py-2 text-center rounded-lg hover:bg-yellow-600 transition cursor-pointer\">\r\n                üì• Import Data (Excel)\r\n              </div>\r\n              <input\r\n                type=\"file\"\r\n                accept=\".xlsx,.csv\"\r\n                onChange={handleImportExcel}\r\n                className=\"hidden\"\r\n              />\r\n            </label>\r\n          </div>\r\n\r\n          <p className=\"text-xs text-gray-500 mt-3\">\r\n            Files are uploaded to your Supabase \"imports\" storage bucket.\r\n          </p>\r\n        </div>\r\n      </div>\r\n\r\n      {message && (\r\n        <p\r\n          className={`mt-6 text-sm ${\r\n            message.startsWith(\"‚úÖ\")\r\n              ? \"text-green-600\"\r\n              : message.startsWith(\"‚ö†Ô∏è\")\r\n              ? \"text-yellow-600\"\r\n              : \"text-red-600\"\r\n          }`}\r\n        >\r\n          {message}\r\n        </p>\r\n      )}\r\n\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMe,SAAS;IACtB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC;IAC/C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,2NAAQ,EAAC;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2NAAQ,EAAC;IACvC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,2NAAQ,EAAC;IACvC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,2NAAQ,EAAC,EAAE,EAAE,2CAA2C;;IAE9F,oBAAoB;IACpB,MAAM,uBAAuB,OAAO;QAClC,EAAE,cAAc;QAChB,WAAW;QACX,IAAI,gBAAgB,iBAAiB;YACnC,WAAW;YACX;QACF;QAEA,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,OAAO;QACxE,IAAI,aAAa,CAAC,MAAM;YACtB,WAAW;YACX;QACF;QAEA,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,kBAAkB,CAAC;YACpE,OAAO,KAAK,KAAK;YACjB,UAAU;QACZ;QACA,IAAI,aAAa;YACf,WAAW;YACX;QACF;QAEA,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,UAAU,CAAC;YAAE,UAAU;QAAY;QACzE,IAAI,OAAO,WAAW,OAAO,MAAM,OAAO;aACrC,WAAW;QAEhB,eAAe;QACf,eAAe;QACf,mBAAmB;IACrB;IAEA,uBAAuB;IACzB,iCAAiC;IACjC,MAAM,oBAAoB;QACxB,WAAW;QACX,WAAW;QACX,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,2IAAQ,CAAC,IAAI,CAAC,gBAAgB,MAAM,CAAC;QACnE,WAAW;QAEX,IAAI,OAAO;YACT,WAAW,8BAA8B,MAAM,OAAO;YACtD;QACF;QAEA,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;YAC9B,WAAW;YACX;QACF;QAEA,mDAAmD;QACnD,MAAM,gBAAgB,KAAK,GAAG,CAAC,CAAC,IAAM,CAAC;gBACrC,MAAM,EAAE,IAAI;gBACZ,MAAM,EAAE,IAAI;gBACZ,UAAU,EAAE,QAAQ;gBACpB,QAAQ,CAAC,EAAE,EAAE,OAAO,EAAE,MAAM,EAAE,cAAc,CAAC,SAAS;oBACpD,uBAAuB;oBACvB,uBAAuB;gBACzB,IAAI;gBACJ,SAAS,EAAE,OAAO,IAAI;YACxB,CAAC;QAED,uBAAuB;QACvB,MAAM,YAAY,gJAAU,CAAC,aAAa,CAAC;QAC3C,MAAM,WAAW,gJAAU,CAAC,QAAQ;QACpC,gJAAU,CAAC,iBAAiB,CAAC,UAAU,WAAW;QAElD,0DAA0D;QAC1D,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACpD,MAAM,WAAW,CAAC,aAAa,EAAE,MAAM,KAAK,CAAC;QAE7C,oBAAoB;QACpB,oJAAc,CAAC,UAAU;QAEzB,WAAW;IACb;IAEA,MAAM,oBAAoB,OAAO;QAC/B,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,CAAC,EAAE;QAC9B,IAAI,CAAC,MAAM;QAEX,MAAM,UAAU,KAAK,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG;QACxC,MAAM,YAAY,KAAK,GAAG;QAC1B,MAAM,kBAAkB,CAAC,OAAO,EAAE,UAAU,CAAC,EAAE,KAAK,IAAI,EAAE,CAAC,sBAAsB;;QAEjF,WAAW;QACX,WAAW;QAEX,sCAAsC;QACtC,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,2IAAQ,CAAC,OAAO,CAClD,IAAI,CAAC,WACL,MAAM,CAAC,iBAAiB,MAAM;YAAE,QAAQ;QAAM,GAAG,mBAAmB;;QAEvE,IAAI,aAAa;YACf,WAAW,sBAAsB,YAAY,OAAO;YACpD,WAAW;YACX;QACF;QAEA,0BAA0B;QAC1B,MAAM,EAAE,MAAM,UAAU,EAAE,GAAG,2IAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,YAAY,CAAC;QAC3E,MAAM,UAAU,WAAW,SAAS;QAEpC,4BAA4B;QAC5B,IAAI;YACF,MAAM,WAAW,MAAM,MAAM;YAC7B,MAAM,cAAc,MAAM,SAAS,WAAW;YAC9C,MAAM,WAAW,+IAAS,CAAC,aAAa;gBAAE,MAAM;YAAQ;YACxD,MAAM,QAAQ,SAAS,MAAM,CAAC,SAAS,UAAU,CAAC,EAAE,CAAC;YACrD,MAAM,WAAW,gJAAU,CAAC,aAAa,CAAC;YAE1C,0BAA0B;YAC1B,MAAM,iBAAiB,SAAS,GAAG,CAAC,CAAC,MAAQ,CAAC;oBAC5C,cAAc,GAAG,CAAC,eAAe,IAAI,GAAG,CAAC,eAAe,IAAI;oBAC5D,OAAO,GAAG,CAAC,QAAQ,IAAI,GAAG,CAAC,QAAQ,IAAI;oBACvC,QAAQ,GAAG,CAAC,SAAS,IAAI,GAAG,CAAC,SAAS,IAAI;gBAC5C,CAAC;YAED,eAAe;YACf,WAAW;YAEX,0BAA0B;YAC1B,MAAM,eAAe,KAAK,IAAI,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,IAAI,IAAI,OAAO,WAAW;YAE9E,qCAAqC;YACrC,MAAM,gBAAgB,eAAe,GAAG,CAAC,CAAC,MAAQ,CAAC;oBACjD,GAAG,GAAG;oBACN,MAAM;gBACR,CAAC;YAED,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,2IAAQ,CAC1C,IAAI,CAAC,iBACL,MAAM,CAAC;YAEV,IAAI,aAAa;gBACf,QAAQ,KAAK,CAAC;gBACd,WAAW,4CAA4C,YAAY,OAAO;YAC5E,OAAO;gBACL,WAAW,CAAC,WAAW,EAAE,cAAc,MAAM,CAAC,0BAA0B,EAAE,aAAa,CAAC,CAAC;YAC3F;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC;YACd,WAAW;QACb;QAEA,WAAW;IACb;IAGE,qBACE,wPAAC;QAAI,WAAU;;0BACb,wPAAC;gBAAG,WAAU;0BAAyC;;;;;;0BAEvD,wPAAC;gBAAI,WAAU;;kCAEb,wPAAC;wBAAI,WAAU;;0CACb,wPAAC;gCAAG,WAAU;0CAA6B;;;;;;0CAE3C,wPAAC;gCAAK,UAAU;gCAAsB,WAAU;;kDAC9C,wPAAC;;0DACC,wPAAC;gDAAM,WAAU;0DAAiC;;;;;;0DAClD,wPAAC;gDACC,MAAK;gDACL,OAAO;gDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gDAC9C,QAAQ;gDACR,WAAU;;;;;;;;;;;;kDAId,wPAAC;;0DACC,wPAAC;gDAAM,WAAU;0DAAiC;;;;;;0DAClD,wPAAC;gDACC,MAAK;gDACL,OAAO;gDACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;gDAC9C,QAAQ;gDACR,WAAU;;;;;;;;;;;;kDAId,wPAAC;;0DACC,wPAAC;gDAAM,WAAU;0DAAiC;;;;;;0DAClD,wPAAC;gDACC,MAAK;gDACL,OAAO;gDACP,UAAU,CAAC,IAAM,mBAAmB,EAAE,MAAM,CAAC,KAAK;gDAClD,QAAQ;gDACR,WAAU;;;;;;;;;;;;kDAId,wPAAC;wCACC,MAAK;wCACL,UAAU;wCACV,WAAU;kDAET,UAAU,kBAAkB;;;;;;;;;;;;;;;;;;kCAMnC,wPAAC;wBAAI,WAAU;;0CACb,wPAAC;gCAAG,WAAU;0CAA6B;;;;;;0CAE3C,wPAAC;gCAAI,WAAU;;kDACb,wPAAC;wCACE,SAAS;wCACT,UAAU;wCACT,WAAU;kDAET,UAAU,iBAAiB;;;;;;kDAIhC,wPAAC;wCAAM,WAAU;;0DACf,wPAAC;gDAAI,WAAU;0DAAqG;;;;;;0DAGpH,wPAAC;gDACC,MAAK;gDACL,QAAO;gDACP,UAAU;gDACV,WAAU;;;;;;;;;;;;;;;;;;0CAKhB,wPAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;;;;;;;YAM7C,yBACC,wPAAC;gBACC,WAAW,CAAC,aAAa,EACvB,QAAQ,UAAU,CAAC,OACf,mBACA,QAAQ,UAAU,CAAC,QACnB,oBACA,gBACJ;0BAED;;;;;;;;;;;;AAMX","debugId":null}}]
}